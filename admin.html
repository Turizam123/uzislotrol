<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>üéõ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª ‚Äì SPIN –†–æ–ª–µ—Ç–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #333, #050608 60%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }
    .admin-card {
      width: 100%;
      max-width: 900px;
      background: rgba(0,0,0,0.8);
      border-radius: 18px;
      padding: 18px 16px 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
      border: 1px solid rgba(255,255,255,0.12);
    }
    h1 {
      margin: 0 0 8px;
      text-align: center;
      font-size: 1.4rem;
    }
    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.8;
      margin-bottom: 14px;
    }
    .subtitle strong { color: #ffd86b; }

    .section {
      margin-bottom: 18px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    label {
      font-size: 0.85rem;
      display: block;
      margin-bottom: 4px;
    }
    input, textarea {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 7px 10px;
      font-size: 0.9rem;
      outline: none;
      margin-bottom: 6px;
    }
    textarea {
      border-radius: 12px;
      min-height: 70px;
      resize: vertical;
    }

    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .row > div {
      flex: 1;
      min-width: 120px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.7);
      white-space: nowrap;
    }
    .btn-primary {
      background: linear-gradient(135deg,#ffeb99,#f4ba00);
      color: #3a2400;
      font-weight: 600;
    }
    .btn-secondary {
      background: rgba(0,0,0,0.5);
      color: #eee;
    }
    .btn-danger {
      background: linear-gradient(135deg,#ff6b6b,#c0392b);
      color:#fff;
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 3px 8px rgba(0,0,0,0.8);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      margin-top: 6px;
    }
    th, td {
      padding: 6px 5px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    th {
      font-weight: 600;
      font-size: 0.8rem;
      opacity: 0.85;
    }
    tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }
    .badge-pending {
      background: rgba(241,196,15,0.2);
      color: #f1c40f;
    }
    .badge-approved {
      background: rgba(46,204,113,0.2);
      color: #2ecc71;
    }

    .small {
      font-size: 0.78rem;
      opacity: 0.78;
    }

    .copy-id-btn {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: none;
      margin-left: 4px;
      cursor: pointer;
      background: rgba(255,255,255,0.08);
      color:#fff;
    }

    @media (max-width:600px){
      th, td { font-size: 0.75rem; }
      .admin-card { padding: 14px 10px; }
    }
  </style>
</head>
<body>

<div class="admin-card">
  <h1>üéõ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª ‚Äì SPIN –†–æ–ª–µ—Ç–∫–∞</h1>
  <div class="subtitle">
    <strong>–í—ä—Ç—Ä–µ—à–µ–Ω –ø–∞–Ω–µ–ª –∑–∞ –∞—Å–∏—Å—Ç–µ–Ω—Ç</strong> ‚Äì —Ç—É–∫ –∑–∞–ø–∏—Å–≤–∞—à —Ä–µ–∞–ª–Ω–∏—Ç–µ ID –Ω–∞ –∏–≥—Ä–∞—á–∏—Ç–µ –∏
    –æ–¥–æ–±—Ä–µ–Ω–∏—Ç–µ –º–æ–Ω–µ—Ç–∏ —Å–ª–µ–¥ –∑–∞—è–≤–∫–∞ –ø–æ e-mail.
  </div>

  <!-- –°–µ–∫—Ü–∏—è 1: –ù–û–í–û –û–î–û–ë–†–ï–ù–ò–ï -->
  <div class="section">
    <div class="section-title">
      <span>‚ûï –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–æ –æ–¥–æ–±—Ä–µ–Ω–∏–µ</span>
      <span class="small">ID-—Ç–æ –≥–æ –≤–∑–∏–º–∞—à –æ—Ç e-mail –∑–∞—è–≤–∫–∞—Ç–∞ (–ø–æ–ª–µ <code>user_id</code>).</span>
    </div>

    <div class="row">
      <div>
        <label for="playerIdInput">User ID –Ω–∞ –∏–≥—Ä–∞—á–∞:</label>
        <input id="playerIdInput" type="text" placeholder="–Ω–∞–ø—Ä. U-AB12CD34">
      </div>
      <div>
        <label for="coinsApprovedInput">–û–¥–æ–±—Ä–µ–Ω–∏ –º–æ–Ω–µ—Ç–∏:</label>
        <input id="coinsApprovedInput" type="number" min="1" step="1" placeholder="–Ω–∞–ø—Ä. 10000">
      </div>
    </div>

    <label for="noteInput">–ë–µ–ª–µ–∂–∫–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏–µ):</label>
    <textarea id="noteInput" placeholder="–ø—Ä–∏–º–µ—Ä: –ø–ª–∞—Ç–µ–Ω–æ –ø–æ Revolut, –¥–∞—Ç–∞, –æ—Å–Ω–æ–≤–∞–Ω–∏–µ..."></textarea>

    <button id="addApprovalBtn" class="btn btn-primary">‚úÖ –ó–∞–ø–∏—à–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ—Ç–æ</button>
  </div>

  <!-- –°–µ–∫—Ü–∏—è 2: –°–ø–∏—Å—ä–∫ —Å –æ–¥–æ–±—Ä–µ–Ω–∏—è -->
  <div class="section">
    <div class="section-title">
      <span>üìã –°–ø–∏—Å—ä–∫ —Å –æ–¥–æ–±—Ä–µ–Ω–∏ –∑–∞—è–≤–∫–∏</span>
      <button id="clearAllBtn" class="btn btn-danger" style="font-size:0.78rem;">üóë –ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏ (–ª–æ–∫–∞–ª–Ω–æ)</button>
    </div>
    <div class="small" style="margin-bottom:4px;">
      –î–∞–Ω–Ω–∏—Ç–µ —Å–µ –ø–∞–∑—è—Ç <strong>—Å–∞–º–æ –≤ —Ç–æ–∑–∏ –±—Ä–∞—É–∑—ä—Ä</strong> (localStorage). –ò–∑–ø–æ–ª–∑–≤–∞–π —Ç–æ–≤–∞ –∫–∞—Ç–æ –≤—ä—Ç—Ä–µ—à–µ–Ω —Ä–µ–≥–∏—Å—Ç—ä—Ä.
    </div>

    <table>
      <thead>
        <tr>
          <th>–î–∞—Ç–∞ / —á–∞—Å</th>
          <th>User ID</th>
          <th>–ú–æ–Ω–µ—Ç–∏</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ë–µ–ª–µ–∂–∫–∞</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="approvalsTableBody">
        <!-- –ø–æ–ø—ä–ª–≤–∞ —Å–µ –æ—Ç JS -->
      </tbody>
    </table>
  </div>

  <!-- –°–µ–∫—Ü–∏—è 3: –ü–æ–º–æ—â–µ–Ω —Ç–µ–∫—Å—Ç –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ –∫—ä–º –∏–≥—Ä–∞—á–∞ -->
  <div class="section">
    <div class="section-title">
      <span>‚úâÔ∏è –®–∞–±–ª–æ–Ω –∑–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ –∫—ä–º –∏–≥—Ä–∞—á–∞</span>
    </div>
    <div class="small" style="margin-bottom:4px;">
      –ò–∑–±–µ—Ä–∏ —Ä–µ–¥ –æ—Ç —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ (–±—É—Ç–æ–Ω ‚Äûüí¨ –°—ä–æ–±—â–µ–Ω–∏–µ‚Äú), –∑–∞ –¥–∞ –ø–æ–ø—ä–ª–Ω–∏—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–æ–∑–∏ —à–∞–±–ª–æ–Ω
      –∏ –¥–∞ –≥–æ –∫–æ–ø–∏—Ä–∞—à –≤ e-mail / —á–∞—Ç –∫—ä–º –∏–≥—Ä–∞—á–∞.
    </div>
    <textarea id="messageTemplate" readonly></textarea>
    <button id="copyMessageBtn" class="btn btn-secondary" style="margin-top:6px;">üìã –ö–æ–ø–∏—Ä–∞–π —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ</button>
  </div>
</div>

<script>
/**
 * –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –∑–∞–ø–∏—Å:
 * {
 *   id: string (–≤—ä—Ç—Ä–µ—à–Ω–æ),
 *   userId: string,
 *   coins: number,
 *   note: string,
 *   status: "approved" | "pending",
 *   createdAt: string (ISO),
 * }
 */

const STORAGE_KEY = "slot_admin_approvals_list";

const playerIdInput = document.getElementById("playerIdInput");
const coinsApprovedInput = document.getElementById("coinsApprovedInput");
const noteInput = document.getElementById("noteInput");
const addApprovalBtn = document.getElementById("addApprovalBtn");
const clearAllBtn = document.getElementById("clearAllBtn");
const approvalsTableBody = document.getElementById("approvalsTableBody");
const messageTemplateEl = document.getElementById("messageTemplate");
const copyMessageBtn = document.getElementById("copyMessageBtn");

let approvals = [];

// –ü–æ–º–æ—â–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏
function loadApprovals(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    approvals = raw ? JSON.parse(raw) : [];
  } catch(e){
    approvals = [];
  }
}

function saveApprovals(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(approvals));
}

function formatDateTime(iso){
  const d = new Date(iso);
  if(Number.isNaN(d.getTime())) return iso;
  const pad = n => n.toString().padStart(2, "0");
  return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function renderApprovals(){
  approvalsTableBody.innerHTML = "";
  if(approvals.length === 0){
    approvalsTableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; opacity:0.7;">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ –æ–¥–æ–±—Ä–µ–Ω–∏—è.</td></tr>`;
    return;
  }

  approvals
    .slice()
    .sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt))
    .forEach(app => {
      const tr = document.createElement("tr");

      const tdDate = document.createElement("td");
      tdDate.textContent = formatDateTime(app.createdAt);
      tr.appendChild(tdDate);

      const tdUserId = document.createElement("td");
      const spanId = document.createElement("span");
      spanId.textContent = app.userId;
      const copyBtn = document.createElement("button");
      copyBtn.textContent = "üìã";
      copyBtn.className = "copy-id-btn";
      copyBtn.title = "–ö–æ–ø–∏—Ä–∞–π ID";
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(app.userId || "").catch(()=>{});
      };
      tdUserId.appendChild(spanId);
      tdUserId.appendChild(copyBtn);
      tr.appendChild(tdUserId);

      const tdCoins = document.createElement("td");
      tdCoins.textContent = app.coins;
      tr.appendChild(tdCoins);

      const tdStatus = document.createElement("td");
      const badge = document.createElement("span");
      badge.classList.add("badge");
      if(app.status === "approved"){
        badge.classList.add("badge-approved");
        badge.textContent = "–û–¥–æ–±—Ä–µ–Ω–æ";
      } else {
        badge.classList.add("badge-pending");
        badge.textContent = "–í –∏–∑—á–∞–∫–≤–∞–Ω–µ";
      }
      tdStatus.appendChild(badge);
      tr.appendChild(tdStatus);

      const tdNote = document.createElement("td");
      tdNote.textContent = app.note || "";
      tr.appendChild(tdNote);

      const tdActions = document.createElement("td");
      tdActions.style.whiteSpace = "nowrap";

      const msgBtn = document.createElement("button");
      msgBtn.textContent = "üí¨";
      msgBtn.className = "copy-id-btn";
      msgBtn.title = "–ì–µ–Ω–µ—Ä–∏—Ä–∞–π —Å—ä–æ–±—â–µ–Ω–∏–µ –∫—ä–º –∏–≥—Ä–∞—á–∞";
      msgBtn.onclick = () => fillMessageTemplate(app);
      tdActions.appendChild(msgBtn);

      const toggleBtn = document.createElement("button");
      toggleBtn.textContent = "‚úî";
      toggleBtn.className = "copy-id-btn";
      toggleBtn.title = "–°–º–µ–Ω–∏ —Å—Ç–∞—Ç—É—Å";
      toggleBtn.onclick = () => toggleStatus(app.id);
      tdActions.appendChild(toggleBtn);

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóë";
      delBtn.className = "copy-id-btn";
      delBtn.title = "–ò–∑—Ç—Ä–∏–π";
      delBtn.onclick = () => deleteApproval(app.id);
      tdActions.appendChild(delBtn);

      tr.appendChild(tdActions);

      approvalsTableBody.appendChild(tr);
    });
}

function toggleStatus(id){
  const index = approvals.findIndex(a => a.id === id);
  if(index === -1) return;
  approvals[index].status = approvals[index].status === "approved" ? "pending" : "approved";
  saveApprovals();
  renderApprovals();
}

function deleteApproval(id){
  if(!confirm("–°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏, —á–µ –∏—Å–∫–∞—à –¥–∞ –∏–∑—Ç—Ä–∏–µ—à —Ç–æ–∑–∏ –∑–∞–ø–∏—Å?")) return;
  approvals = approvals.filter(a => a.id !== id);
  saveApprovals();
  renderApprovals();
}

function addApproval(){
  const userId = (playerIdInput.value || "").trim();
  const coins = parseInt(coinsApprovedInput.value, 10);
  const note = (noteInput.value || "").trim();

  if(!userId){
    alert("–ú–æ–ª—è, –≤—ä–≤–µ–¥–∏ User ID –Ω–∞ –∏–≥—Ä–∞—á–∞.");
    return;
  }
  if(!coins || coins <= 0){
    alert("–ú–æ–ª—è, –≤—ä–≤–µ–¥–∏ –≤–∞–ª–∏–¥–µ–Ω –±—Ä–æ–π –º–æ–Ω–µ—Ç–∏ (>0).");
    return;
  }

  const nowIso = new Date().toISOString();
  const newItem = {
    id: "APP-" + Math.random().toString(36).substring(2,10),
    userId,
    coins,
    note,
    status: "approved", // –ø—Ä–∏–µ–º–∞–º–µ —á–µ —Ç–æ–≤–∞ –µ –≤–µ—á–µ –æ–¥–æ–±—Ä–µ–Ω–æ
    createdAt: nowIso
  };

  approvals.push(newItem);
  saveApprovals();
  renderApprovals();

  // –ò–∑—á–∏—Å—Ç–≤–∞–º–µ —Ñ–æ—Ä–º–∞—Ç–∞
  coinsApprovedInput.value = "";
  noteInput.value = "";
  // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ —Ç–µ–º–ø–ª–µ–π—Ç–∞ –∑–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ
  fillMessageTemplate(newItem);
}

function fillMessageTemplate(app){
  const priceEur = (app.coins * 0.02).toFixed(2);
  const txt =
`–ó–¥—Ä–∞–≤–µ–π,

–í–∞—à–∞—Ç–∞ –∑–∞—è–≤–∫–∞ –∑–∞ –ø–æ–∫—É–ø–∫–∞ –Ω–∞ –º–æ–Ω–µ—Ç–∏ –≤ –∏–≥—Ä–∞—Ç–∞ "SPIN –†–æ–ª–µ—Ç–∫–∞" –µ –û–î–û–ë–†–ï–ù–ê. ‚úÖ

User ID: ${app.userId}
–û–¥–æ–±—Ä–µ–Ω–∏ –º–æ–Ω–µ—Ç–∏: ${app.coins}
–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤—ä—á–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç: ${priceEur} EUR

–°–ª–µ–¥ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª–∞—â–∞–Ω–µ—Ç–æ (–ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–∏—è —Å –í–∞—Å –º–µ—Ç–æ–¥),
–º–æ–Ω–µ—Ç–∏—Ç–µ —â–µ –±—ä–¥–∞—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ –í–∏.

–ü–æ–∑–¥—Ä–∞–≤–∏,
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è / –ê—Å–∏—Å—Ç–µ–Ω—Ç`;
  messageTemplateEl.value = txt;
}

function copyMessage(){
  const txt = messageTemplateEl.value || "";
  if(!txt){
    alert("–ù—è–º–∞ —Ç–µ–∫—Å—Ç –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ.");
    return;
  }
  navigator.clipboard.writeText(txt)
    .then(() => { alert("–°—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ –µ –∫–æ–ø–∏—Ä–∞–Ω–æ."); })
    .catch(() => { alert("–ù–µ—É—Å–ø–µ—à–Ω–æ –∫–æ–ø–∏—Ä–∞–Ω–µ (–æ–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ)."); });
}

// –°—ä–±–∏—Ç–∏—è
addApprovalBtn.onclick = addApproval;
clearAllBtn.onclick = () => {
  if(!confirm("–°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏, —á–µ –∏—Å–∫–∞—à –¥–∞ –∏–∑—á–∏—Å—Ç–∏—à –≤—Å–∏—á–∫–∏ –∑–∞–ø–∏—Å–∏?")) return;
  approvals = [];
  saveApprovals();
  renderApprovals();
};
copyMessageBtn.onclick = copyMessage;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
loadApprovals();
renderApprovals();
</script>

</body>
</html>
