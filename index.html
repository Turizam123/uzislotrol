<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>üé∞ SPIN –†–æ–ª–µ—Ç–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA (–ø–æ –∂–µ–ª–∞–Ω–∏–µ ‚Äì –∞–∫–æ –∏–º–∞—à manifest.json –∏ sw.js) -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">
  <link rel="icon" href="icon-192.png">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #444, #111 55%);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .game-wrapper { max-width: 480px; width: 100%; padding: 20px; }
    .card {
      background: rgba(0,0,0,0.85);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.9);
      border: 1px solid rgba(255,255,255,0.06);
    }
    h1 { text-align:center; margin:0 0 10px; }
    .subtitle {
      text-align:center;
      font-size:0.9rem;
      opacity:0.85;
      margin-bottom:8px;
    }
    .status-bar { display:flex; justify-content:space-between; margin:10px 0; font-size:0.95rem; }
    .highlight { color:#ffd86b; }
    .slot-frame { margin-top:14px; }
    .slot-window { padding:10px; background:#222; border-radius:14px; box-shadow:inset 0 0 12px #000; }
    .slot-grid {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      grid-template-rows:repeat(3,80px);
      gap:8px;
    }
    .cell {
      background:#111;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:2.4rem;
      box-shadow:inset 0 0 8px #000;
      transition:transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }
    .middle-row {
      box-shadow:0 0 0 1px rgba(255,215,0,0.7), 0 0 12px rgba(255,215,0,0.5);
    }
    .win {
      background: radial-gradient(circle at 30% 20%, #fff4c2, #e0a900 55%);
      color:#000;
      box-shadow:0 0 0 2px rgba(0,0,0,0.7),0 0 20px rgba(255,230,150,0.8);
    }
    .seven-win {
      animation:seven 0.3s infinite alternate;
      box-shadow:0 0 20px red, 0 0 30px gold;
    }
    @keyframes seven {
      from { transform:scale(1); }
      to   { transform:scale(1.12); }
    }

    @keyframes reel-spin {
      0% { transform:translateY(0); }
      50% { transform:translateY(4px); }
      100% { transform:translateY(0); }
    }
    .spinning .cell { animation:reel-spin 0.18s infinite; }

    .controls {
      display:flex;
      justify-content:space-between;
      margin-top:15px;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .spin-btn {
      flex:1;
      padding:12px;
      background:radial-gradient(circle at 20% 20%, #ffec9b,#f4ba00 55%,#a86800);
      border:none;
      border-radius:999px;
      font-size:1.1rem;
      font-weight:bold;
      color:#351f00;
      cursor:pointer;
      box-shadow:0 10px 24px rgba(0,0,0,0.8);
    }
    .spin-btn:active {
      transform:translateY(1px) scale(0.99);
      box-shadow:0 4px 16px rgba(0,0,0,0.9);
    }
    .spin-btn:disabled { opacity:0.6; cursor:not-allowed; }

    .bet-box { display:flex; gap:8px; align-items:center; }
    .icon-btn {
      width:30px; height:30px;
      border-radius:999px;
      border:none;
      background:rgba(255,255,255,0.08);
      color:#fff;
      cursor:pointer;
      font-size:1.1rem;
    }
    #resultText {
      text-align:center;
      margin-top:12px;
      min-height:22px;
      font-size:0.95rem;
    }

    /* –ë–∞–ª–æ–Ω—á–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç */
    #history {
      margin-top: 10px;
      text-align: center;
      min-height: 30px;
    }

    .history-box {
      display: inline-block;
      position: relative;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid transparent;
      font-size: 0.85rem;
      max-width: 100%;
      white-space: nowrap;
    }

    .history-box::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid transparent; /* –ø–æ-–∫—ä—Å–Ω–æ —Å–º–µ–Ω—è–º–µ —Ü–≤–µ—Ç–∞ –∑–∞ win/lose */
    }

    .history-win {
      border-color: rgba(46, 204, 113, 0.9);
      color: #c9ffd8;
      box-shadow: 0 0 10px rgba(46, 204, 113, 0.7), 0 0 20px rgba(39, 174, 96, 0.9);
      animation: historyPulseGreen 0.5s ease-in-out 0s 4 alternate;
    }
    .history-win::after {
      border-top-color: rgba(46, 204, 113, 0.9);
    }

    .history-lose {
      border-color: rgba(231, 76, 60, 0.9);
      color: #ffd1d1;
      box-shadow: 0 0 10px rgba(231, 76, 60, 0.7), 0 0 20px rgba(192, 57, 43, 0.9);
      animation: historyPulseRed 0.5s ease-in-out 0s 3 alternate;
    }
    .history-lose::after {
      border-top-color: rgba(231, 76, 60, 0.9);
    }

    @keyframes historyPulseGreen {
      from {
        transform: translateY(0) scale(1);
      }
      to {
        transform: translateY(-2px) scale(1.05);
      }
    }

    @keyframes historyPulseRed {
      from {
        transform: translateY(0) scale(1);
      }
      to {
        transform: translateY(-2px) scale(1.05);
      }
    }

    @media (max-width:480px){
      .slot-grid{ grid-template-rows:repeat(3,68px); }
      .cell{ font-size:2rem; }
      .history-box { white-space: normal; }
    }
  </style>
</head>
<body>

<div class="game-wrapper">
  <div class="card">

    <h1>üé∞ SPIN –†–æ–ª–µ—Ç–∫–∞</h1>
    <p class="subtitle">
      –ü–æ–¥—Ä–µ–¥–∏ 3 –µ–¥–Ω–∞–∫–≤–∏ —Å–∏–º–≤–æ–ª–∞ –Ω–∞ <span class="highlight">—Å—Ä–µ–¥–Ω–∏—è —Ä–µ–¥</span> –∏ –ø–µ—á–µ–ª–∏—à!
    </p>

    <div class="status-bar">
      <div>–ë–∞–ª–∞–Ω—Å: <span id="balance" class="highlight">100</span> ü™ô</div>
      <div>–†–µ–∂–∏–º: <span id="modeLabel">–ù–æ—Ä–º–∞–ª–µ–Ω</span></div>
    </div>

    <div class="slot-frame">
      <div class="slot-window" id="slotWindow">
        <div class="slot-grid" id="slotGrid">
          <div class="cell" data-row="0" data-col="0">‚ùì</div>
          <div class="cell" data-row="0" data-col="1">‚ùì</div>
          <div class="cell" data-row="0" data-col="2">‚ùì</div>

          <div class="cell middle-row" data-row="1" data-col="0">‚ùì</div>
          <div class="cell middle-row" data-row="1" data-col="1">‚ùì</div>
          <div class="cell middle-row" data-row="1" data-col="2">‚ùì</div>

          <div class="cell" data-row="2" data-col="0">‚ùì</div>
          <div class="cell" data-row="2" data-col="1">‚ùì</div>
          <div class="cell" data-row="2" data-col="2">‚ùì</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <div class="bet-box">
        <button class="icon-btn" id="betMinus">‚àí</button>
        <span id="betValue">5</span>
        <button class="icon-btn" id="betPlus">+</button>
      </div>

      <button id="spinBtn" class="spin-btn">SPIN</button>
    </div>

    <div id="resultText">–ü–µ—á–∞–ª–±–∞ –ø—Ä–∏ 3 –µ–¥–Ω–∞–∫–≤–∏ —Å–∏–º–≤–æ–ª–∞ –ø–æ —Å—Ä–µ–¥–Ω–∏—è —Ä–µ–¥.</div>

    <!-- –ë–∞–ª–æ–Ω—á–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç -->
    <div id="history"></div>

  </div>
</div>

<!-- –ê—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤–µ (.wav) -->
<audio id="audioSpin" src="spin_effect.wav" preload="auto"></audio>
<audio id="audioSpinMusic" src="spin_music.wav" preload="auto"></audio>
<audio id="audioWin" src="win.wav" preload="auto"></audio>
<audio id="audioLose" src="lose.wav" preload="auto"></audio>
<audio id="bgMusic" src="music.wav" preload="auto" loop></audio>

<script>
const SYMBOLS = [
  {emoji:"7Ô∏è‚É£",weightNormal:1,weightEasy:2},
  {emoji:"üîî",weightNormal:1,weightEasy:3},
  {emoji:"üçí",weightNormal:2,weightEasy:4},
  {emoji:"üçë",weightNormal:3,weightEasy:4},
  {emoji:"üçê",weightNormal:4,weightEasy:5},
  {emoji:"üçá",weightNormal:5,weightEasy:5},
];

const PAYOUTS = {"7Ô∏è‚É£":100,"üîî":50,"üçí":35,"üçë":25,"üçê":18,"üçá":12};

let balance=100, bet=5;
let spinning=false, easyMode=false;
let spinInterval=null, stopRequested=false, autoStopTimeout=null;
let bgMusicStarted=false;

/* DOM */
const balanceEl=document.getElementById("balance");
const betValueEl=document.getElementById("betValue");
const spinBtn=document.getElementById("spinBtn");
const betMinusBtn=document.getElementById("betMinus");
const betPlusBtn=document.getElementById("betPlus");
const resultText=document.getElementById("resultText");
const gridEl=document.getElementById("slotGrid");
const slotWindow=document.getElementById("slotWindow");
const modeLabel=document.getElementById("modeLabel");
const historyEl=document.getElementById("history");

/* Audio */
const audioSpin=document.getElementById("audioSpin");
const audioSpinMusic=document.getElementById("audioSpinMusic");
const audioWin=document.getElementById("audioWin");
const audioLose=document.getElementById("audioLose");
const bgMusic=document.getElementById("bgMusic");

function getDateTime() {
  const d = new Date();
  const pad = n => n.toString().padStart(2,"0");
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ` +
         `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
}

function updateUI(){
  balanceEl.textContent=balance;
  betValueEl.textContent=bet;
}

function play(audio){
  if(!audio) return;
  try { audio.currentTime=0; audio.play(); } catch(e){}
}

function weightedPool(){
  let pool=[];
  SYMBOLS.forEach(s=>{
    let w= easyMode ? s.weightEasy : s.weightNormal;
    for(let i=0;i<w;i++) pool.push(s.emoji);
  });
  return pool;
}

function setGrid(matrix){
  document.querySelectorAll(".cell").forEach(c=>{
    let r=c.dataset.row, col=c.dataset.col;
    c.textContent=matrix[r][col];
  });
}

function clearWin(){
  document.querySelectorAll(".cell").forEach(c=>{
    c.classList.remove("win","seven-win");
  });
}

/* –∑–∞ –±—ä–¥–µ—â–µ ‚Äì –∞–∫–æ –∏—Å–∫–∞—à –±—É—Ç–æ–Ω –∑–∞ —Ä–µ–∂–∏–º */
modeLabel.textContent = easyMode ? "–ü–æ-–ª–µ—Å–µ–Ω" : "–ù–æ—Ä–º–∞–ª–µ–Ω";

function startSpin(){
  if(spinning) return;
  if(bet>balance){
    resultText.textContent="–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–µ–Ω –±–∞–ª–∞–Ω—Å.";
    return;
  }

  spinning=true;
  stopRequested=false;
  spinBtn.textContent="STOP";

  // –ø—Ä–∏ –Ω–æ–≤–æ –∑–∞–≤—ä—Ä—Ç–∞–Ω–µ —Å–∫—Ä–∏–≤–∞–º–µ –±–∞–ª–æ–Ω—á–µ—Ç–æ
  historyEl.innerHTML = "";
  historyEl.className = "";

  clearWin();

  balance-=bet; updateUI();

  if(!bgMusicStarted){ play(bgMusic); bgMusicStarted=true; }

  play(audioSpin);
  play(audioSpinMusic);

  const pool=weightedPool();
  let matrix=[["","",""],["","",""],["","",""]];

  slotWindow.classList.add("spinning");

  spinInterval=setInterval(()=>{
    for(let c=0;c<3;c++){
      for(let r=0;r<3;r++){
        matrix[r][c]= pool[Math.floor(Math.random()*pool.length)];
      }
    }
    setGrid(matrix);
    if(stopRequested){
      clearInterval(spinInterval);
      finalize(matrix);
    }
  },90);

  autoStopTimeout=setTimeout(()=>{stopRequested=true;},1600);
}

function stopSpin(){ stopRequested=true; }

function finalize(matrix){
  clearInterval(spinInterval);
  slotWindow.classList.remove("spinning");
  if(autoStopTimeout) clearTimeout(autoStopTimeout);

  try{ audioSpinMusic.pause(); audioSpinMusic.currentTime=0; }catch(e){}

  let s1=matrix[1][0], s2=matrix[1][1], s3=matrix[1][2];
  let win=false, winAmount=0;

  if(s1===s2 && s2===s3 && PAYOUTS[s1]){
    win=true;
    winAmount=PAYOUTS[s1]*bet;
  }

  if(win){
    balance+=winAmount;
    if(s1==="7Ô∏è‚É£"){
      resultText.textContent="üíé –î–ñ–ê–ö–ü–û–¢! –ü–µ—á–µ–ª–∏—à "+winAmount+" –º–æ–Ω–µ—Ç–∏!";
    }else{
      resultText.textContent="üéâ –ü–µ—á–∞–ª–±–∞: "+winAmount+" –º–æ–Ω–µ—Ç–∏!";
    }
    let cells=document.querySelectorAll(".middle-row");
    cells.forEach(c=>{
      c.classList.add("win");
      if(s1==="7Ô∏è‚É£") c.classList.add("seven-win");
    });
    play(audioWin);
  } else {
    resultText.textContent="‚ùå –ù—è–º–∞ –ø–µ—á–∞–ª–±–∞. –û–ø–∏—Ç–∞–π –ø–∞–∫!";
    play(audioLose);
  }

  // –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –±–∞–ª–æ–Ω—á–µ—Ç–æ —Å –¥–∞—Ç–∞/—á–∞—Å, –∑–∞–ª–æ–≥ –∏ —Ä–µ–∑—É–ª—Ç–∞—Ç
  const dt = getDateTime();
  if (win) {
    historyEl.innerHTML =
      `<div class="history-box history-win">[${dt}] –ó–∞–ª–æ–≥: ${bet} | –ü–µ—á–∞–ª–±–∞: ${winAmount} | –ö–æ–º–±–∏–Ω–∞—Ü–∏—è: ${s1} ${s2} ${s3}</div>`;
  } else {
    historyEl.innerHTML =
      `<div class="history-box history-lose">[${dt}] –ó–∞–ª–æ–≥: ${bet} | –ë–µ–∑ –ø–µ—á–∞–ª–±–∞</div>`;
  }

  spinning=false;
  spinBtn.textContent="SPIN";
  updateUI();
}

spinBtn.onclick=()=> spinning ? stopSpin() : startSpin();
betMinusBtn.onclick=()=>{ if(!spinning && bet>1){ bet--; updateUI(); } }
betPlusBtn.onclick=()=>{ if(!spinning && bet<50){ bet++; updateUI(); } }

// –Ω–∞—á–∞–ª–Ω–∞ –ø–æ–¥—Ä–µ–¥–±–∞
setGrid([
  ["üîî","üçí","üçá"],
  ["üçë","üçê","üçá"],
  ["üçí","üçá","üîî"],
]);
updateUI();

// PWA service worker (–ø–æ –∂–µ–ª–∞–Ω–∏–µ, –∞–∫–æ –∏–º–∞—à sw.js)
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js").catch(()=>{});
}
</script>

</body>
</html>
