<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>üé∞ SPIN –†–æ–ª–µ—Ç–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA (–º–æ–∂–µ—à –¥–∞ –º–∞—Ö–Ω–µ—à —Ç–µ–∑–∏ 3 —Ä–µ–¥–∞, –∞–∫–æ –Ω–µ —Ç–∏ —Ç—Ä—è–±–≤–∞ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è) -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">
  <link rel="icon" href="icon-192.png">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #444, #111 55%);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .game-wrapper { max-width: 480px; width: 100%; padding: 20px; }
    .card {
      background: rgba(0,0,0,0.85);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.9);
      border: 1px solid rgba(255,255,255,0.06);
    }
    h1 { text-align:center; margin:0 0 10px; }
    .subtitle {
      text-align:center;
      font-size:0.9rem;
      opacity:0.85;
      margin-bottom:8px;
    }
    .status-bar { display:flex; justify-content:space-between; margin:10px 0; font-size:0.95rem; }
    .highlight { color:#ffd86b; }
    .slot-frame { margin-top:14px; }
    .slot-window { padding:10px; background:#222; border-radius:14px; box-shadow:inset 0 0 12px #000; }
    .slot-grid {
      display:grid;
      grid-template-columns:repeat(3,1fr);
      grid-template-rows:repeat(3,80px);
      gap:8px;
    }
    .cell {
      background:#111;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:2.4rem;
      box-shadow:inset 0 0 8px #000;
    }
    .middle-row { box-shadow:0 0 0 1px rgba(255,215,0,0.7), 0 0 12px rgba(255,215,0,0.5); }
    .win {
      background: radial-gradient(circle at 30% 20%, #fff4c2, #e0a900 55%);
      color:#000;
      box-shadow:0 0 0 2px rgba(0,0,0,0.7),0 0 20px rgba(255,230,150,0.8);
    }
    .seven-win {
      animation:seven 0.3s infinite alternate;
      box-shadow:0 0 20px red, 0 0 30px gold;
    }
    @keyframes seven {
      from { transform:scale(1); }
      to   { transform:scale(1.12); }
    }
    .controls { display:flex; justify-content:space-between; margin-top:15px; gap:10px; align-items:center; }
    .spin-btn {
      flex:1;
      padding:12px;
      background:radial-gradient(circle at 20% 20%, #ffec9b,#f4ba00 55%,#a86800);
      border:none;
      border-radius:999px;
      font-size:1.1rem;
      font-weight:bold;
      color:#351f00;
      cursor:pointer;
      box-shadow:0 10px 24px rgba(0,0,0,0.8);
    }
    .spin-btn:active { transform:translateY(1px) scale(0.99); box-shadow:0 4px 16px rgba(0,0,0,0.9); }
    .bet-box { display:flex; gap:8px; align-items:center; }
    .icon-btn {
      width:30px; height:30px;
      border-radius:999px;
      border:none;
      background:rgba(255,255,255,0.08);
      color:#fff;
      cursor:pointer;
      font-size:1.1rem;
    }
    #resultText { text-align:center; margin-top:12px; min-height:22px; font-size:0.95rem; }
    @keyframes reel-spin {
      0% { transform:translateY(0); }
      50% { transform:translateY(4px); }
      100% { transform:translateY(0); }
    }
    .spinning .cell { animation:reel-spin 0.18s infinite; }

    @media (max-width:480px){
      .slot-grid{ grid-template-rows:repeat(3,68px); }
      .cell{ font-size:2rem; }
    }
  </style>
</head>
<body>

<div class="game-wrapper">
  <div class="card">

    <h1>üé∞ SPIN –†–æ–ª–µ—Ç–∫–∞</h1>
    <p class="subtitle">–ü–æ–¥—Ä–µ–¥–∏ 3 –µ–¥–Ω–∞–∫–≤–∏ —Å–∏–º–≤–æ–ª–∞ –Ω–∞ <span class="highlight">—Å—Ä–µ–¥–Ω–∏—è —Ä–µ–¥</span> –∏ –ø–µ—á–µ–ª–∏—à!</p>

    <div class="status-bar">
      <div>–ë–∞–ª–∞–Ω—Å: <span id="balance" class="highlight">100</span> ü™ô</div>
      <div>–†–µ–∂–∏–º: <span id="modeLabel">–ù–æ—Ä–º–∞–ª–µ–Ω</span></div>
    </div>

    <div class="slot-frame">
      <div class="slot-window" id="slotWindow">
        <div class="slot-grid" id="slotGrid">
          <div class="cell" data-row="0" data-col="0">‚ùì</div>
          <div class="cell" data-row="0" data-col="1">‚ùì</div>
          <div class="cell" data-row="0" data-col="2">‚ùì</div>

          <div class="cell middle-row" data-row="1" data-col="0">‚ùì</div>
          <div class="cell middle-row" data-row="1" data-col="1">‚ùì</div>
          <div class="cell middle-row" data-row="1" data-col="2">‚ùì</div>

          <div class="cell" data-row="2" data-col="0">‚ùì</div>
          <div class="cell" data-row="2" data-col="1">‚ùì</div>
          <div class="cell" data-row="2" data-col="2">‚ùì</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <div class="bet-box">
        <button class="icon-btn" id="betMinus">‚àí</button>
        <span id="betValue">5</span>
        <button class="icon-btn" id="betPlus">+</button>
      </div>

      <button id="spinBtn" class="spin-btn">SPIN</button>
    </div>

    <div id="resultText">–ü–µ—á–∞–ª–±–∞ –ø—Ä–∏ 3 –µ–¥–Ω–∞–∫–≤–∏ —Å–∏–º–≤–æ–ª–∞ –ø–æ —Å—Ä–µ–¥–Ω–∏—è —Ä–µ–¥.</div>

  </div>
</div>

<!-- –ê—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤–µ (.wav) -->
<audio id="audioSpin" src="spin_effect.wav" preload="auto"></audio>
<audio id="audioSpinMusic" src="spin_music.wav" preload="auto"></audio>
<audio id="audioWin" src="win.wav" preload="auto"></audio>
<audio id="audioLose" src="lose.wav" preload="auto"></audio>
<audio id="bgMusic" src="music.wav" preload="auto" loop></audio>

<script>
const SYMBOLS = [
  {emoji:"7Ô∏è‚É£",weightNormal:1,weightEasy:2},
  {emoji:"üîî",weightNormal:1,weightEasy:3},
  {emoji:"üçí",weightNormal:2,weightEasy:4},
  {emoji:"üçë",weightNormal:3,weightEasy:4},
  {emoji:"üçê",weightNormal:4,weightEasy:5},
  {emoji:"üçá",weightNormal:5,weightEasy:5},
];

const PAYOUTS = {"7Ô∏è‚É£":100,"üîî":50,"üçí":35,"üçë":25,"üçê":18,"üçá":12};

let balance=100, bet=5;
let spinning=false, easyMode=false;
let spinInterval=null, stopRequested=false, autoStopTimeout=null;
let bgMusicStarted=false;

/* DOM */
const balanceEl=document.getElementById("balance");
const betValueEl=document.getElementById("betValue");
const spinBtn=document.getElementById("spinBtn");
const betMinusBtn=document.getElementById("betMinus");
const betPlusBtn=document.getElementById("betPlus");
const resultText=document.getElementById("resultText");
const gridEl=document.getElementById("slotGrid");
const slotWindow=document.getElementById("slotWindow");
const modeLabel=document.getElementById("modeLabel");

/* Audio */
const audioSpin=document.getElementById("audioSpin");
const audioSpinMusic=document.getElementById("audioSpinMusic");
const audioWin=document.getElementById("audioWin");
const audioLose=document.getElementById("audioLose");
const bgMusic=document.getElementById("bgMusic");

function updateUI(){
  balanceEl.textContent=balance;
  betValueEl.textContent=bet;
}

function play(audio){
  if(!audio) return;
  try { audio.currentTime=0; audio.play(); } catch(e){}
}

function weightedPool(){
  let pool=[];
  SYMBOLS.forEach(s=>{
    let w= easyMode ? s.weightEasy : s.weightNormal;
    for(let i=0;i<w;i++) pool.push(s.emoji);
  });
  return pool;
}

function setGrid(matrix){
  document.querySelectorAll(".cell").forEach(c=>{
    let r=c.dataset.row, col=c.dataset.col;
    c.textContent=matrix[r][col];
  });
}

function clearWin(){
  document.querySelectorAll(".cell").forEach(c=>{
    c.classList.remove("win","seven-win");
  });
}

function startSpin(){
  if(spinning) return;
  if(bet>balance){
    resultText.textContent="–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–µ–Ω –±–∞–ª–∞–Ω—Å.";
    return;
  }
  spinning=true;
  stopRequested=false;
  spinBtn.textContent="STOP";
  clearWin();

  balance-=bet; updateUI();

  if(!bgMusicStarted){ play(bgMusic); bgMusicStarted=true; }

  play(audioSpin);
  play(audioSpinMusic);

  const pool=weightedPool();
  let matrix=[["","",""],["","",""],["","",""]];

  slotWindow.classList.add("spinning");

  spinInterval=setInterval(()=>{
    for(let c=0;c<3;c++){
      for(let r=0;r<3;r++){
        matrix[r][c]= pool[Math.floor(Math.random()*pool.length)];
      }
    }
    setGrid(matrix);
    if(stopRequested){
      clearInterval(spinInterval);
      finalize(matrix);
    }
  },90);

  autoStopTimeout=setTimeout(()=>{stopRequested=true;},1600);
}

function stopSpin(){ stopRequested=true; }

function finalize(matrix){
  clearInterval(spinInterval);
  slotWindow.classList.remove("spinning");
  if(autoStopTimeout) clearTimeout(autoStopTimeout);

  try{ audioSpinMusic.pause(); audioSpinMusic.currentTime=0; }catch(e){}

  let s1=matrix[1][0], s2=matrix[1][1], s3=matrix[1][2];
  let win=false, amount=0;

  if(s1===s2 && s2===s3 && PAYOUTS[s1]){
    win=true;
    amount=PAYOUTS[s1]*bet;
  }

  if(win){
    balance+=amount;
    if(s1==="7Ô∏è‚É£"){
      resultText.textContent="üíé –î–ñ–ê–ö–ü–û–¢! –ü–µ—á–µ–ª–∏—à "+amount+" –º–æ–Ω–µ—Ç–∏!";
    }else{
      resultText.textContent="üéâ –ü–µ—á–∞–ª–±–∞: "+amount+" –º–æ–Ω–µ—Ç–∏!";
    }
    let cells=document.querySelectorAll(".middle-row");
    cells.forEach(c=>{
      c.classList.add("win");
      if(s1==="7Ô∏è‚É£") c.classList.add("seven-win");
    });
    play(audioWin);
  } else {
    resultText.textContent="‚ùå –ù—è–º–∞ –ø–µ—á–∞–ª–±–∞. –û–ø–∏—Ç–∞–π –ø–∞–∫!";
    play(audioLose);
  }

  spinning=false;
  spinBtn.textContent="SPIN";
  updateUI();
}

spinBtn.onclick=()=> spinning ? stopSpin() : startSpin();
betMinusBtn.onclick=()=>{ if(!spinning && bet>1){ bet--; updateUI(); } }
betPlusBtn.onclick=()=>{ if(!spinning && bet<50){ bet++; updateUI(); } }

// –Ω–∞—á–∞–ª–Ω–∞ –ø–æ–¥—Ä–µ–¥–±–∞
setGrid([
  ["üîî","üçí","üçá"],
  ["üçë","üçê","üçá"],
  ["üçí","üçá","üîî"],
]);
updateUI();

// PWA service worker (–ø–æ –∂–µ–ª–∞–Ω–∏–µ, –∞–∫–æ –∏–º–∞—à sw.js)
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js").catch(()=>{});
}
</script>

</body>
</html>
